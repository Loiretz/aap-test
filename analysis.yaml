---
- name: Analysis
  hosts: all
  strategy: free
  gather_facts: true
  become: true
  force_handlers: true

  vars:
    rhsm_username: MY_USERNAME
    rhsm_password: MY_PASSWORD
    rhsm_org: MY_ORG
    rhsm_activation_key: MY_ACTIVATION_KEY

  tasks:
    - name: Check if resolv.conf file exists
      ansible.builtin.stat:
        path: /etc/resolv.conf
      register: file_info

    - name: Create /etc/resolv.conf if it exists
      ansible.builtin.file:
        path: /etc/resolv.conf
        state: touch
      when: not file_info.stat.exists

    - name: Set DNS nameservers in /etc/resolv.conf
      ansible.builtin.blockinfile:
        path: /etc/resolv.conf
        block: |
            search example.com
            nameserver 8.8.8.8
            nameserver 8.8.4.4

    - name: Check resolv.conf
      ansible.builtin.command: cat /etc/resolv.conf

    - name: Generate pre-conversion analysis report
      ansible.builtin.import_role:
        name: infra.convert2rhel.analysis
   
    - name: display report convert2rhel
      ansible.builtin.debug:
        msg: "{{ lookup('ansible.builtin.file', '/var/log/convert2rhel/convert2rhel-pre-conversion.txt') }}"
